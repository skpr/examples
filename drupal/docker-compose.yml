version: "3"

services:

  ##################
  # Web
  ##################

  nginx:
    image: skpr/nginx:1.x-dev
    ports:
      - 8080:8080
      - 3306:3306
    volumes:
      - data:/data

  php-fpm: &php-fpm
    image: skpr/php-fpm:8.0-1.x-dev
    network_mode: service:nginx
    volumes:
      - data:/data
#      - .skpr/package/php.ini:/etc/php/conf.d/50_custom.ini

  php-fpm-xdebug:
    <<: *php-fpm
    image: skpr/php-fpm:8.0-1.x-xdebug
    environment:
      - PHP_FPM_PORT=9001
      - PHP_IDE_CONFIG=serverName=localhost

  ##################
  # CLI
  ##################

  php-cli: &php-cli
    image: skpr/php-cli:8.0-1.x-dev
    network_mode: service:nginx
    volumes:
      - data:/data

  php-cli-xdebug:
    <<: *php-cli
    image: skpr/php-cli:8.0-1.x-xdebug
    environment:
      - PHP_IDE_CONFIG=serverName=localhost

  node:
    image: skpr/node:14-1.x
    network_mode: service:nginx
    volumes:
      - data:/data

  ##################
  # Databases
  ##################

  mysql-default:
    # For "skpr2 mysql pull dev" to get the latest image.
    image: 221404021726.dkr.ecr.ap-southeast-2.amazonaws.com/skpr-shared-pnx-d8/mysql:dev-default-latest
    network_mode: service:nginx

  ##################
  # Services
  ##################

  mailhog:
    image: mailhog/mailhog
    ports:
      - 8025:8025

  syslog:
    image: skpr/syslog
    network_mode: service:nginx

  chrome:
    image: selenium/standalone-chrome
    network_mode: service:nginx

volumes:
  data:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: ${PWD}
