version: "3"

services:

  ##################
  # Web
  ##################

  nginx:
    image: skpr/nginx-drupal:dev-v2-latest
    ports:
      - 8080:8080
      - 3306:3306
    extra_hosts:
      - "host.docker.internal:host-gateway"
    volumes:
      - data:/data

  php-fpm:
    image: skpr/php-fpm:8.0-dev-v2-latest
    network_mode: service:nginx
    volumes:
      - data:/data
    environment:
      - PHP_IDE_CONFIG=serverName=localhost

  ##################
  # CLI
  ##################

  php-cli:
    image: skpr/php-cli:8.0-dev-v2-latest
    network_mode: service:nginx
    volumes:
      - data:/data

  node:
    image: skpr/node:16-v2-latest
    network_mode: service:nginx
    volumes:
      - data:/data

  ##################
  # Databases
  ##################

  mysql-default:
    # For "skpr2 mysql pull dev" to get the latest image.
    image: xxxxxxxxx.dkr.ecr.ap-southeast-2.amazonaws.com/xxxxxxxx/mysql:dev-default-latest
    network_mode: service:nginx

  ##################
  # Services
  ##################

  mailhog:
    image: mailhog/mailhog
    ports:
      - 8025:8025

volumes:
  data:
    driver: local
    driver_opts:
      o: bind
      type: none
      device: ${PWD}
